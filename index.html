<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rayyan Calendar | Sunnah & Productivity</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- 1. PREMIUM VARIABLES --- */
        :root {
            /* Palette: Ethereal Dawn */
            --bg-gradient-1: #ff9a9e;
            --bg-gradient-2: #fecfef;
            --bg-gradient-3: #a1c4fd;
            
            /* Glassmorphism */
            --glass-surface: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.4);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            
            /* Text Colors (Dark Blue for contrast on light BG) */
            --text-primary: #2c3e50;
            --text-secondary: #566573;
            --accent-gold: #d4af37;
            --accent-purple: #6c5ce7;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Lato', sans-serif;
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            
            /* ANIMATED BACKGROUND */
            background: linear-gradient(-45deg, #ff9a9e, #fad0c4, #a18cd1, #fbc2eb);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- 2. LAYOUT --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            display: grid;
            grid-template-columns: 1fr 350px; /* Calendar Left, Sidebar Right */
            gap: 30px;
        }

        /* HEADER */
        header {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--glass-surface);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .brand-title {
            font-family: 'Playfair Display', serif;
            font-size: 32px;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .current-month {
            font-size: 24px;
            font-weight: 300;
            color: #fff;
        }

        /* --- 3. CALENDAR GRID --- */
        .calendar-wrapper {
            background: var(--glass-surface);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            padding: 30px;
            box-shadow: var(--glass-shadow);
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 15px;
            font-weight: 700;
            color: #fff;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
        }

        .day-card {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 15px;
            min-height: 100px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
        }

        .day-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.7);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .day-number {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
            display: block;
        }

        /* FASTING INDICATORS */
        .fast-tag {
            display: inline-block;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 8px;
            color: white;
            margin-bottom: 4px;
            font-weight: 600;
        }
        .tag-senin-kamis { background: linear-gradient(to right, #667eea, #764ba2); }
        .tag-ayyamul { background: linear-gradient(to right, #ff9966, #ff5e62); }

        /* EVENT DOTS */
        .event-dot {
            height: 6px;
            width: 6px;
            background-color: var(--text-primary);
            border-radius: 50%;
            display: inline-block;
            margin-right: 2px;
        }

        /* --- 4. SIDEBAR (SNIPPETS) --- */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--glass-border);
        }

        .card-title {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--text-primary);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            padding-bottom: 10px;
        }

        .next-fast-box {
            text-align: center;
            background: linear-gradient(135deg, rgba(255,255,255,0.4), rgba(255,255,255,0.1));
            padding: 20px;
            border-radius: 15px;
        }
        .countdown { font-size: 32px; font-weight: 700; color: var(--accent-purple); }
        .countdown-label { font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }

        /* --- 5. MODAL (DETAIL HARI) --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 62, 80, 0.4);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modal-overlay.active { display: flex; opacity: 1; }

        .modal-card {
            background: #fff; /* Solid white for readability inside modal */
            width: 90%;
            max-width: 500px;
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            transform: scale(0.9);
            transition: transform 0.3s;
            position: relative;
        }
        .modal-overlay.active .modal-card { transform: scale(1); }

        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-date { font-family: 'Playfair Display'; font-size: 24px; font-weight: 700; }
        
        .menu-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .menu-label { font-size: 12px; color: var(--accent-purple); font-weight: 700; text-transform: uppercase; margin-bottom: 5px; }
        .menu-item { font-size: 16px; color: #333; display: flex; align-items: center; gap: 10px; }

        .schedule-list { list-style: none; margin-top: 10px; }
        .schedule-item { 
            padding: 10px; 
            border-bottom: 1px solid #eee; 
            display: flex; justify-content: space-between;
            color: var(--text-secondary);
        }

        .btn-close {
            background: #f1f1f1; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
        }

        /* RESPONSIVE */
        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; }
            .weekdays, .days-grid { gap: 5px; }
            .day-card { min-height: 80px; padding: 5px; }
            .day-number { font-size: 14px; }
            .fast-tag { font-size: 8px; padding: 2px 4px; }
        }
        /* --- UPDATE HEADER NAVIGASI --- */
        header {
            /* Pastikan header menggunakan layout ini */
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Agar aman di HP */
            gap: 15px;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .current-month {
            font-size: 20px;
            font-weight: 600;
            color: #fff;
            min-width: 150px; /* Supaya lebar tetap stabil saat ganti bulan */
            text-align: center;
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        /* --- REVISI CSS AGAR TANGGAL MUNCUL --- */
        .day-number {
            font-size: 18px;
            font-weight: 800; /* Dibuat sangat tebal */
            color: #2c3e50;   /* Warna Gelap (Dark Blue) - Jangan Putih! */
            margin-bottom: 5px;
            display: block;
            text-shadow: none; /* Hilangkan bayangan jika ada */
            position: relative;
            z-index: 2; /* Pastikan di atas layer background */
        }

        .day-card {
            /* Pastikan background kartu agak kontras */
            background: rgba(255, 255, 255, 0.45); 
            /* ... sisa style lama ... */
            display: flex;       /* Tambahan biar rapi */
            flex-direction: column;
            justify-content: flex-start;
        }
        .schedule-item { 
            padding: 10px; 
            border-bottom: 1px solid #eee; 
            display: flex; 
            justify-content: space-between; /* Agar teks di kiri, tombol hapus di kanan */
            align-items: center;
            color: var(--text-secondary);
        }
        /* STYLE INPUT MENU DI MODAL */
        .menu-input {
            width: 100%;
            background: transparent;
            border: none; /* Hilangkan border kasar */
            border-bottom: 1px dashed rgba(0,0,0,0.1); /* Garis bantu tipis */
            font-family: 'Lato', sans-serif;
            font-size: 16px;
            color: #333;
            resize: none; /* Matikan resize pojok */
            height: 40px; /* Tinggi awal */
            outline: none;
            padding: 5px 0;
            transition: 0.3s;
        }

        .menu-input:focus {
            border-bottom: 1px solid var(--accent-purple);
            background: rgba(255,255,255,0.5);
        }

        /* Placeholder styling */
        .menu-input::placeholder {
            color: #aaa;
            font-style: italic;
            font-size: 14px;
        }
        /* =========================================
           RESPONSIVE MOBILE DESIGN (HP MODE)
           ========================================= */
        @media screen and (max-width: 768px) {
            
            /* 1. LAYOUT UTAMA */
            .container {
                grid-template-columns: 1fr; /* Ubah jadi 1 kolom ke bawah */
                padding: 15px; /* Kurangi padding pinggir */
                gap: 20px;
            }

            /* 2. HEADER & NAVIGASI */
            header {
                flex-direction: column; /* Judul di atas, Navigasi di bawah */
                gap: 15px;
                text-align: center;
                padding: 15px;
            }

            .brand-title {
                font-size: 24px; /* Kecilkan judul */
                width: 100%;
            }

            .nav-controls {
                width: 100%;
                justify-content: space-between; /* Tombol panah di ujung kiri-kanan */
                padding: 8px 15px;
            }

            .current-month {
                font-size: 16px; /* Kecilkan font bulan */
            }

            /* 3. GRID KALENDER */
            .calendar-wrapper {
                padding: 15px; /* Kurangi padding dalam */
                border-radius: 20px;
            }

            .weekdays {
                font-size: 10px; /* Nama hari lebih kecil (Sen, Sel...) */
                margin-bottom: 10px;
            }

            .weekdays, .days-grid {
                gap: 8px; /* Jarak antar kotak lebih rapat */
            }

            .day-card {
                min-height: 60px; /* Tinggi kotak tanggal dikurangi */
                padding: 5px;
                border-radius: 10px;
            }

            .day-number {
                font-size: 14px; /* Angka tanggal lebih kecil */
                margin-bottom: 2px;
            }

            /* 4. TAG PUASA (Senin-Kamis / Ayyamul Bidh) */
            .fast-tag {
                font-size: 7px; /* Font sangat kecil agar muat */
                padding: 2px;
                line-height: 1.2;
                white-space: nowrap; /* Jangan biarkan teks turun baris */
                overflow: hidden;    /* Potong jika kepanjangan */
                text-overflow: ellipsis; 
                width: 100%;
                text-align: center;
            }
            
            .event-dot {
                width: 4px;
                height: 4px;
                margin-right: 1px;
            }

            /* 5. SIDEBAR (INFO & SNIPPET) */
            .sidebar {
                order: 2; /* Pindah ke bawah kalender */
                margin-bottom: 40px; /* Beri ruang gerak di bawah */
            }

            .info-card {
                padding: 20px;
            }

            /* 6. MODAL (POPUP EDIT) */
            .modal-card {
                width: 95%; /* Lebar modal hampir full layar */
                padding: 20px;
                max-height: 85vh; /* Batasi tinggi agar tidak ketutup keyboard */
                overflow-y: auto; /* Bisa discroll jika konten panjang */
            }

            .modal-date {
                font-size: 20px;
            }

            .menu-input {
                font-size: 14px; /* Font input nyaman dibaca */
            }
        }
    </style>
</head>
<body>

    <div class="container">
      <header>
            <div class="brand-title"><i class="fa-solid fa-moon"></i> Rayyan Calendar</div>
            
            <div class="nav-controls">
                <button class="nav-btn" onclick="changeMonth(-1)">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                
                <div class="current-month" id="monthDisplay">Loading...</div>
                
                <button class="nav-btn" onclick="changeMonth(1)">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
        </header>

        <div class="calendar-wrapper">
            <div class="weekdays">
                <div>Min</div><div>Sen</div><div>Sel</div><div>Rab</div><div>Kam</div><div>Jum</div><div>Sab</div>
            </div>
            <div class="days-grid" id="calendarGrid">
                </div>
        </div>

        <div class="sidebar">
            <div class="info-card">
                <div class="card-title">Puasa Berikutnya</div>
                <div class="next-fast-box">
                    <div class="countdown" id="daysToFast">2</div>
                    <div class="countdown-label">Hari Lagi</div>
                    <div style="margin-top: 10px; color: var(--text-primary); font-weight: 600;">Kamis</div>
                </div>
            </div>

            <div class="info-card">
                <div class="card-title" style="display:flex; justify-content:space-between; align-items:center;">
                    Snippet Menu
                    <button onclick="addNewMenuGlobal()" style="border:none; background:none; color:var(--accent-purple); cursor:pointer; font-size:12px;">
                        <i class="fa-solid fa-plus"></i> Tambah
                    </button>
                </div>
                <div style="font-size: 14px; color: var(--text-secondary); line-height: 1.6;">
                    <i class="fa-solid fa-utensils"></i> <strong>Tips:</strong><br>
                    Klik tombol (+) di atas untuk menambahkan kombinasi menu sahur & buka favoritmu ke dalam sistem acak.
                </div>
            </div>
        </div>
    </div>

   <div class="modal-overlay" id="dayModal">
        <div class="modal-card">
            <div class="modal-header">
                <span class="modal-date" id="modalDate">Tanggal</span>
                <button class="btn-close" onclick="closeModal()"><i class="fa-solid fa-xmark"></i></button>
            </div>

         <div id="fastingContent" style="display:none;">
        <div class="menu-section">
            <div class="menu-label"><i class="fa-solid fa-mug-hot"></i> Menu Sahur (Edit)</div>
            <textarea id="sahurInput" class="menu-input" placeholder="Tulis menu sahur..."></textarea>
        </div>

        <div class="menu-section" style="background: #fff0f0;">
            <div class="menu-label" style="color: #e74c3c;"><i class="fa-solid fa-glass-water"></i> Menu Buka (Edit)</div>
            <textarea id="iftarInput" class="menu-input" placeholder="Tulis menu buka..."></textarea>
        </div>

        <button onclick="saveDailyMenu()" style="width:100%; margin-bottom:20px; padding:12px; border:none; background:var(--accent-purple); color:white; border-radius:10px; cursor:pointer; font-weight:600; font-size:14px;">
            <i class="fa-solid fa-floppy-disk"></i> Simpan Menu
        </button>
    </div>

            <div class="card-title" style="font-size: 16px; margin-top: 10px; border-bottom:1px solid #eee; padding-bottom:10px;">
                Jadwal Kegiatan
            </div>
            
            <ul class="schedule-list" id="scheduleList">
                </ul>
            
            <button style="width:100%; margin-top:15px; padding:10px; border:1px dashed #aaa; background:transparent; color:#555; border-radius:10px; cursor:pointer; font-size:13px;" onclick="addEvent()">
                + Tambah Jadwal Baru
            </button>
        </div>
    </div>

    <script>
        // --- 1. DATA & CONFIG ---
         // ... (Kode Data Menu Global & Events yang lama biarkan saja) ...

        // C. DATA MENU HARIAN (Spesifik per Tanggal)
        // Format: { "9-12": {sahur: "...", iftar: "..."} }
        let dailyMenus = JSON.parse(localStorage.getItem('rayyan_daily_menus')) || {};

        // Update fungsi saveData agar menyimpan dailyMenus juga
        function saveData() {
            localStorage.setItem('rayyan_menus', JSON.stringify(menus));
            localStorage.setItem('rayyan_events', JSON.stringify(events));
            // Simpan menu harian
            localStorage.setItem('rayyan_daily_menus', JSON.stringify(dailyMenus)); 
        }
        let date = new Date(); 
        let currentMonth = date.getMonth();
        let currentYear = date.getFullYear();

        // Data Simulasi Menu (Bisa diperbanyak)
       // A. DATA MENU (Bisa ditambah user)
        const defaultMenus = [
            { sahur: "Oatmeal Pisang & Madu", iftar: "Teh Manis & Gorengan + Pecel Lele" },
            { sahur: "Roti Gandum Telur Dadar", iftar: "Es Buah & Nasi Padang (Lauk Telur)" },
            { sahur: "Nasi Sarden & Sayur", iftar: "Kurma & Soto Ayam" },
            { sahur: "Susu Kurma & Biskuit", iftar: "Air Kelapa & Mie Goreng" }
        ];

        // Load dari LocalStorage atau pakai Default
        let menus = JSON.parse(localStorage.getItem('rayyan_menus')) || defaultMenus;

        // B. DATA JADWAL (Bisa diedit user)
        const defaultEvents = {
            "9-5": ["08:00 - Kuliah Algoritma"], 
            "9-12": ["10:00 - Bimbingan Skripsi"]
        };

        // Load dari LocalStorage atau pakai Default
        let events = JSON.parse(localStorage.getItem('rayyan_events')) || defaultEvents;


        // --- FUNGSI PENYIMPANAN DATA (AUTO SAVE) ---
        function saveData() {
            localStorage.setItem('rayyan_menus', JSON.stringify(menus));
            localStorage.setItem('rayyan_events', JSON.stringify(events));
        }

        const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];    
        // Simulasi Ayyamul Bidh (Hardcoded untuk contoh, misal tgl 13, 14, 15 bulan ini)
        // Di aplikasi nyata, ini butuh konverter Hijriyah
        const ayyamulBidh = [13, 14, 15]; 

function changeMonth(direction) {
            currentMonth += direction;

            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear -= 1;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear += 1;
            }
            renderCalendar();
        }

       function renderCalendar() {
            // 1. Update Header Bulan & Tahun
            document.getElementById('monthDisplay').innerText = `${monthNames[currentMonth]} ${currentYear}`;
            
            // 2. Hitung Hari
            const firstDayIndex = new Date(currentYear, currentMonth, 1).getDay();
            const lastDate = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = ""; // Bersihkan grid lama

            // 3. Render Slot Kosong (Untuk hari sebelum tanggal 1)
            for (let i = 0; i < firstDayIndex; i++) {
                const empty = document.createElement('div');
                // Opsional: kasih class agar transparan total
                empty.style.visibility = 'hidden'; 
                grid.appendChild(empty);
            }

            // 4. Render Tanggal 1 s.d. Akhir
            for (let i = 1; i <= lastDate; i++) {
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                
                // Cek Hari (0=Min, 1=Sen, 4=Kam)
                const checkDate = new Date(currentYear, currentMonth, i);
                const dayOfWeek = checkDate.getDay();
                
                let isFastingDay = false;
                let fastType = "";

                // Logic Puasa Senin Kamis
                if (dayOfWeek === 1 || dayOfWeek === 4) {
                    isFastingDay = true;
                    fastType = "Senin-Kamis";
                }

                // Logic Ayyamul Bidh (Simulasi tgl 13, 14, 15)
                if ([13, 14, 15].includes(i)) {
                    isFastingDay = true;
                    fastType = "Ayyamul Bidh";
                }

                // --- BAGIAN PENTING: MENYUSUN HTML KARTU ---
                // Pastikan variabel ${i} ada di dalam span day-number
                let htmlContent = `<span class="day-number">${i}</span>`;
                
                if (isFastingDay) {
                    const tagClass = fastType === "Ayyamul Bidh" ? "tag-ayyamul" : "tag-senin-kamis";
                    htmlContent += `<span class="fast-tag ${tagClass}">${fastType}</span>`;
                }

                // Cek Event
                const eventKey = `${currentMonth}-${i}`;
                if (events && events[eventKey]) {
                    htmlContent += `<div style="margin-top:5px;">`;
                    events[eventKey].forEach(() => {
                        htmlContent += `<span class="event-dot"></span>`;
                    });
                    htmlContent += `</div>`;
                }

                // Masukkan HTML ke dalam element
                dayCard.innerHTML = htmlContent;
                
                // Event Listener Klik
                dayCard.onclick = () => openModal(i, isFastingDay, fastType, eventKey);

                grid.appendChild(dayCard);
            }
        }
      
      
        // --- 3. MODAL & INTERACTION ---
        const modal = document.getElementById('dayModal');
       // --- 3. MODAL & INTERACTION (UPDATED) ---
        let selectedEventKey = ""; // Key unik misal "9-12" (Bulan 9 Tanggal 12)

function openModal(day, isFasting, type, eventKey) {
            selectedEventKey = eventKey; 
            
            // 1. UPDATE TANGGAL HEADER
            // Pastikan di HTML ada <span id="modalDate">...</span>
            const dateElement = document.getElementById('modalDate');
            if (dateElement) {
                dateElement.innerText = `${day} ${monthNames[currentMonth]} ${currentYear}`;
            }

            // 2. LOGIKA MENU PUASA
            const fastingContent = document.getElementById('fastingContent');
            
            if (isFasting) {
                if (fastingContent) fastingContent.style.display = 'block';

                // --- BAGIAN INI YANG BIKIN ERROR SEBELUMNYA ---
                // Kita gunakan ID baru: 'sahurInput' dan 'iftarInput'
                const sahurField = document.getElementById('sahurInput');
                const iftarField = document.getElementById('iftarInput');

                // Cek dulu apakah elemennya benar-benar ada di HTML biar gak error
                if (sahurField && iftarField) {
                    
                    // Cek apakah user pernah simpan menu di tanggal ini?
                    if (dailyMenus[selectedEventKey]) {
                        // Jika ADA, isi input dengan data tersimpan
                        sahurField.value = dailyMenus[selectedEventKey].sahur;
                        iftarField.value = dailyMenus[selectedEventKey].iftar;
                    } else {
                        // Jika BELUM, ambil random default
                        const randomMenu = menus[Math.floor(Math.random() * menus.length)];
                        sahurField.value = randomMenu.sahur;
                        iftarField.value = randomMenu.iftar;
                    }
                } else {
                    console.error("Elemen 'sahurInput' atau 'iftarInput' tidak ditemukan di HTML!");
                }
                // ------------------------------------------------

            } else {
                if (fastingContent) fastingContent.style.display = 'none';
            }

            // 3. LOAD JADWAL
            renderEvents(selectedEventKey);
            
            // 4. BUKA MODAL
            modal.classList.add('active');
        }
        // --- 3. MODAL INTERACTION (EDIT & ADD) ---
       

   function openModal(day, isFasting, type, eventKey) {
            selectedEventKey = eventKey;
            
            // 1. Set Tanggal di Header
            const dateElem = document.getElementById('modalDate');
            if(dateElem) {
                dateElem.innerText = `${day} ${monthNames[currentMonth]} ${currentYear}`;
            }
            
            const fastingContent = document.getElementById('fastingContent');
            
            if (isFasting) {
                if(fastingContent) fastingContent.style.display = 'block';
                
                // --- PERBAIKAN DI SINI ---
                
                // Gunakan ID yang benar sesuai HTML baru: 'sahurInput' & 'iftarInput'
                const sahurField = document.getElementById('sahurInput');
                const iftarField = document.getElementById('iftarInput');
                
                // Pastikan elemen ditemukan sebelum diisi agar tidak error
                if (sahurField && iftarField) {
                    
                    // Cek: Apakah user sudah pernah simpan menu untuk tanggal ini?
                    // Pastikan variabel 'dailyMenus' sudah dideklarasikan di bagian atas script
                    if (typeof dailyMenus !== 'undefined' && dailyMenus[selectedEventKey]) {
                        // Jika ADA data tersimpan, tampilkan itu
                        sahurField.value = dailyMenus[selectedEventKey].sahur;
                        iftarField.value = dailyMenus[selectedEventKey].iftar;
                    } else {
                        // Jika TIDAK ADA, ambil rekomendasi random
                        const randomMenu = menus[Math.floor(Math.random() * menus.length)];
                        sahurField.value = randomMenu.sahur;
                        iftarField.value = randomMenu.iftar;
                    }
                }

            } else {
                if(fastingContent) fastingContent.style.display = 'none';
            }

            // Load Jadwal
            renderEvents(selectedEventKey);
            
            // Tampilkan Modal
            modal.classList.add('active');
        }
        // FUNGSI RENDER EVENT (DENGAN TOMBOL HAPUS)
        function renderEvents(key) {
            const list = document.getElementById('scheduleList');
            list.innerHTML = '';
            
            if (events[key] && events[key].length > 0) {
                events[key].forEach((ev, index) => {
                    const li = document.createElement('li');
                    li.className = 'schedule-item';
                    
                    // Layout Flex untuk Teks dan Tombol Hapus
                    li.innerHTML = `
                        <span>${ev}</span>
                        <button onclick="deleteEvent('${key}', ${index})" style="background:none; border:none; color:red; cursor:pointer; font-size:12px;">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    `;
                    list.appendChild(li);
                });
            } else {
                list.innerHTML = '<li class="schedule-item" style="color:#aaa; font-style:italic;">Tidak ada jadwal</li>';
            }
        }

        // FUNGSI TAMBAH JADWAL (SIMPAN PERMANEN)
        function addEvent() {
            const newEvent = prompt("Masukkan Jadwal (Contoh: 10:00 - Meeting):");
            if (newEvent) {
                if (!events[selectedEventKey]) {
                    events[selectedEventKey] = [];
                }
                events[selectedEventKey].push(newEvent);
                saveData(); // Simpan ke LocalStorage
                renderEvents(selectedEventKey);
                renderCalendar(); // Refresh dot di kalender
            }
        }

        // FUNGSI HAPUS JADWAL
        function deleteEvent(key, index) {
            if(confirm("Hapus jadwal ini?")) {
                events[key].splice(index, 1); // Hapus dari array
                saveData(); // Simpan perubahan
                renderEvents(key); // Refresh list modal
                renderCalendar(); // Refresh dot di kalender
            }
        }

        // FUNGSI TAMBAH MENU BARU (GLOBAL)
        function addNewMenuGlobal() {
            const sahur = prompt("Masukkan Menu Sahur Baru:");
            if(!sahur) return;
            
            const iftar = prompt("Masukkan Menu Buka Puasa Baru:");
            if(!iftar) return;

            menus.push({ sahur: sahur, iftar: iftar });
            saveData();
            alert("Menu berhasil ditambahkan ke dalam database rekomendasi!");
        }
       
        
        function closeModal() {
            modal.classList.remove('active');
        }

        // --- 4. INIT ---
        renderCalendar();

        // Close modal on outside click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
// FUNGSI SIMPAN MENU HARIAN
        function saveDailyMenu() {
            // 1. Ambil elemen input
            const sahurField = document.getElementById('sahurInput');
            const iftarField = document.getElementById('iftarInput');

            // 2. Pastikan elemen ada
            if (sahurField && iftarField) {
                
                // 3. Simpan data ke variabel global dailyMenus
                // selectedEventKey adalah variabel global yang menyimpan tanggal saat ini (misal "9-12")
                dailyMenus[selectedEventKey] = {
                    sahur: sahurField.value,
                    iftar: iftarField.value
                };

                // 4. Simpan ke LocalStorage browser agar permanen
                saveData(); 

                // 5. Beri notifikasi berhasil
                alert("Menu berhasil disimpan untuk tanggal ini!");
                
            } else {
                console.error("Gagal menyimpan: Elemen input tidak ditemukan.");
            }
        }
    </script>
</body>
</html>